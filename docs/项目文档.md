
# 火星搜索 (Huoxing Search) - 完整项目文档

> **版本**: v1.0  
> **语言**: Go 1.24+  
> **作者**: YJC562  
> **更新日期**: 2025-01-18

---

## 📋 目录

1. [项目简介](#项目简介)
2. [快速开始](#快速开始)
3. [Docker部署](#docker部署)
4. [配置说明](#配置说明)
5. [功能说明](#功能说明)
6. [常见问题](#常见问题)
7. [技术架构](#技术架构)

---

## 项目简介

火星搜索是一个高性能的网盘资源搜索和转存系统，从 PHP 版 Xinyue-Search 重构为 Go 版本，性能提升 5-10 倍。

### 核心特性

- ⚡ **高性能**：搜索响应 < 1秒，支持 1000+ QPS
- 🔍 **全网搜索**：集成 Pansou 搜索引擎，50+ 搜索插件
- 💾 **多网盘支持**：夸克、百度、阿里云盘、UC、迅雷
- 📱 **微信集成**：支持对话开放平台和公众号回调
- 🐳 **Docker部署**：一键构建，轻量镜像（~80MB）

### 性能对比

| 指标 | PHP版本 | Go版本 | 提升 |
|------|---------|--------|------|
| 搜索响应 | 2-5秒 | <1秒 | 5-10倍 |
| 并发能力 | 50-100 QPS | 1000+ QPS | 10倍 |
| 转存速度 | 3-8秒 | <2秒 | 3-4倍 |
| 内存占用 | 500MB-1GB | <200MB | 降低70% |
| CPU占用 | 60-80% | <40% | 降低50% |

---

## 快速开始

### 前提条件

- Docker 和 Docker Compose
- MySQL 8.0+
- Redis 7.0+（可选，用于缓存）

### 部署步骤

```bash
# 1. 克隆项目
git clone https://github.com/yjc562/huoxing-search.git
cd huoxing-search

# 2. 构建Docker镜像
docker build -t yjc562/huoxing-search:latest .

# 3. 启动服务
docker-compose up -d

# 4. 查看日志
docker-compose logs -f
```

### 首次安装

1. 访问安装向导：`http://服务器IP:6060/install`
2. 填写数据库配置：
   - 数据库地址：MySQL服务器IP
   - 数据库端口：3306
   - 数据库用户：root
   - 数据库密码：你的密码
   - 数据库名称：huoxing
3. 设置管理员账户
4. 完成安装

### 访问系统

- **前台页面**：http://localhost:6060
- **管理后台**：http://localhost:6060/admin
- **安装向导**：http://localhost:6060/install（首次运行）

---

## Docker部署

### 目录结构

```
huoxing-search/
├── docker-compose.yml       # Docker编排文件
├── Dockerfile               # Docker镜像定义
├── data/                    # 数据目录（持久化）
│   ├── config.yaml          # 系统配置
│   └── install.lock         # 安装锁
└── ...
```

### docker-compose.yml

```yaml
version: '3.8'

services:
  huoxing-app:
    image: yjc562/huoxing-search:latest
    container_name: huoxing-app
    restart: always
    ports:
      - "6060:6060"
    volumes:
      - ./data:/app/data
    environment:
      - TZ=Asia/Shanghai
```

### 常用命令

```bash
# 启动服务
docker-compose up -d

# 停止服务
docker-compose down

# 查看日志
docker-compose logs -f

# 重启服务
docker-compose restart

# 查看状态
docker-compose ps

# 更新镜像
docker-compose pull
docker-compose up -d
```

### 使用公开镜像

```bash
# 直接拉取并运行
docker pull yjc562/huoxing-search:latest
docker run -d -p 6060:6060 -v ./data:/app/data yjc562/huoxing-search:latest
```

---

## 配置说明

### 数据库配置

安装向导会自动生成配置文件 `data/config.yaml`：

```yaml
database:
  host: mysql-host
  port: 3306
  username: root
  password: your-password
  database: huoxing
```

### 网盘配置

在管理后台"网盘配置"页面配置：

#### 1. 夸克网盘
- **配置项**：Cookie
- **获取方式**：
  1. 登录 https://pan.quark.cn
  2. F12 打开开发者工具
  3. 找到 Cookie 中的完整值
  4. 复制到配置页面

#### 2. 百度网盘
- **配置项**：Cookie
- **获取方式**：同上，登录百度网盘获取

#### 3. 阿里云盘
- **配置项**：RefreshToken
- **获取方式**：
  1. 登录 https://www.aliyundrive.com
  2. F12 开发者工具 → Application → Local Storage
  3. 找到 refresh_token 的值

#### 4. UC网盘
- **配置项**：Cookie
- **获取方式**：同夸克网盘方式

#### 5. 迅雷网盘
- **配置项**：Cookie
- **获取方式**：同夸克网盘方式

**注意**：配置完成后点击"测试连接"验证配置是否正确。

### 微信配置

#### 微信对话开放平台

1. 访问 https://openai.weixin.qq.com/ 注册账号
2. 创建应用获取：
   - AppID
   - Token
   - EncodingAESKey
3. 在管理后台"微信配置"填写上述信息
4. 配置回调URL：`https://你的域名/api/wechat/callback`

#### 微信公众号

1. 在公众号后台配置服务器地址
2. 获取 Token
3. 在管理后台"微信配置"填写
4. 配置回调URL：`https://你的域名/api/wechat/mp/callback`

**重要提示**：
- 微信回调必须使用 HTTPS
- 需要配置 Nginx 反向代理
- 配置完成后点击"测试连接"验证

---

## 功能说明

### 1. 全网搜索

#### 搜索功能
- 支持关键词搜索
- 自动调用 Pansou 50+ 搜索插件
- 智能结果排序和去重
- 支持按网盘类型筛选

#### API接口

```http
POST /api/search
Content-Type: application/json

{
  "keyword": "关键词",
  "pan_type": 0,    // 0=夸克 2=百度 3=UC 4=迅雷
  "max_count": 10
}
```

### 2. 资源转存

#### 转存功能
- 一键转存到指定网盘
- 并发处理（最多5个同时）
- 自动过滤无效链接
- 支持批量转存

#### API接口

```http
POST /api/transfer
Content-Type: application/json

{
  "url": "分享链接",
  "pan_type": 0,
  "save_path": "/目标路径"
}
```

### 3. 资源管理

- 资源列表查看
- 资源分类管理
- 资源搜索和筛选
- 批量导入/删除

### 4. 用户管理

- 用户注册/登录
- 权限管理
- 操作日志
- 数据统计

### 5. 系统配置

- 基础设置
- SEO配置
- 网盘配置
- 微信配置
- API线路配置

---

## 常见问题

### Q1: Docker 构建失败，提示网络错误

**问题**：`go mod download` 失败，提示 EOF 或超时

**解决方案**：
1. 检查网络连接，确保可以访问 proxy.golang.org
2. 稍后重试
3. 如果持续失败，检查防火墙设置

### Q2: 首次运行无法访问

**问题**：访问 http://localhost:6060 无响应

**解决方案**：
1. 检查容器是否正常运行：`docker-compose ps`
2. 查看日志：`docker-compose logs`
3. 确认端口没有被占用：`netstat -ano | findstr 6060`

### Q3: 安装完成后无法登录

**问题**：提示用户名或密码错误

**解决方案**：
1. 确认使用安装时设置的管理员账号
2. 检查数据库连接是否正常
3. 查看日志文件排查问题

### Q4: 搜索没有结果

**问题**：搜索关键词后返回空结果

**解决方案**：
1. 检查 Pansou 搜索引擎是否正常
2. 查看后台"API线路配置"是否启用
3. 检查网盘配置是否正确
4. 查看系统日志排查错误

### Q5: 转存失败

**问题**：点击转存后提示失败

**解决方案**：
1. 检查网盘 Cookie 是否过期
2. 在"网盘配置"页面测试连接
3. 确认目标网盘有足够空间
4. 检查分享链接是否有效

### Q6: 微信回调不成功

**问题**：微信消息无法触发回调

**解决方案**：
1. 确认使用 HTTPS（微信要求）
2. 检查回调 URL 配置是否正确
3. 在"微信配置"页面测试连接
4. 查看 Nginx 日志和应用日志

### Q7: 配置文件丢失

**问题**：重启容器后配置丢失

**解决方案**：
1. 确认 data 目录已正确挂载
2. 检查 docker-compose.yml 的 volumes 配置
3. 确保宿主机 data 目录有写权限

---

## 技术架构

### 技术栈

| 层级 | 技术 | 版本 | 说明 |
|------|------|------|------|
| 后端语言 | Go | 1.24+ | 高性能、低资源 |
| Web框架 | Gin | v1.9+ | 轻量高效 |
| ORM | GORM | v2.0+ | 功能完善 |
| 数据库 | MySQL | 8.0 | 稳定可靠 |
| 缓存 | Redis | 7.0 | 高性能缓存 |
| 搜索引擎 | Pansou | latest | 50+插件 |
| 容器化 | Docker | latest | 标准化部署 |

### 项目结构

```
huoxing-search/
├── cmd/server/              # 程序入口
│   └── main.go              # 启动文件
├── internal/                # 核心代码
│   ├── api/                 # HTTP处理器
│   │   ├── router.go        # 路由配置
│   │   ├── install.go       # 安装向导
│   │   ├── search.go        # 搜索接口
│   │   ├── transfer.go      # 转存接口
│   │   ├── wechat.go        # 微信接口
│   │   └── ...
│   ├── service/             # 业务逻辑
│   │   ├── search_service.go
│   │   ├── transfer_service.go
│   │   └── ...
│   ├── repository/          # 数据访问
│   │   ├── config_repo.go
│   │   └── ...
│   ├── model/               # 数据模型
│   ├── netdisk/             # 网盘SDK（5种）
│   │   ├── quark/           # 夸克网盘
│   │   ├── baidu/           # 百度网盘
│   │   ├── aliyun/          # 阿里云盘
│   │   ├── uc/              # UC网盘
│   │   └── xunlei/          # 迅雷网盘
│   ├── middleware/          # 中间件
│   └── pkg/                 # 工具包
├── pansou/                  # Pansou搜索引擎
│   ├── plugin/              # 50+搜索插件
│   └── service/             # 搜索服务
├── web/                     # 前端资源
│   ├── templates/           # HTML模板
│   └── static/              # 静态文件
├── install/                 # 安装文件
│   └── data.sql             # 数据库初始化
├── docker-compose.yml       # Docker编排
├── Dockerfile               # Docker镜像
└── go.mod                   # Go模块定义
```

### 核心模块

#### 1. 搜索服务
- 调用 Pansou API 获取搜索结果
