{{define "admin/batch_import.html"}}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹é‡å¯¼å…¥ - Xinyue</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
        }
        
        .admin-layout { display: flex; height: 100vh; }
        
        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 250px;
            background: #001529;
            color: #fff;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding: 20px;
            font-size: 20px;
            font-weight: bold;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        .sidebar-menu { flex: 1; overflow-y: auto; }
        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255,255,255,0.65);
            text-decoration: none;
        }
        .menu-item:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .menu-item.active { background: #1890ff; color: #fff; }
        .menu-group { margin: 10px 0; }
        .menu-group-title {
            padding: 10px 20px;
            color: rgba(255,255,255,0.45);
            font-size: 12px;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .header {
            height: 60px;
            background: #fff;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        .header-title { font-size: 18px; font-weight: bold; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .user-info:hover { background: #f0f0f0; }
        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #1890ff;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .content { flex: 1; padding: 20px; overflow-y: auto; }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary { background: #1890ff; color: #fff; }
        .btn-primary:hover { background: #40a9ff; }
        .btn-success { background: #52c41a; color: #fff; }
        .btn-success:hover { background: #73d13d; }
        .btn-default { background: #fff; color: #333; border: 1px solid #d9d9d9; }
        .btn-default:hover { color: #1890ff; border-color: #1890ff; }
        
        /* å¡ç‰‡ */
        .card {
            background: #fff;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e8e8e8;
        }
        
        /* è¡¨å• */
        .form-group {
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        .form-select, .form-input, .form-textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
        }
        .form-select:focus, .form-input:focus, .form-textarea:focus { border-color: #1890ff; }
        .form-textarea {
            resize: vertical;
            min-height: 400px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        .form-help {
            margin-top: 4px;
            font-size: 12px;
            color: #999;
        }
        
        /* æç¤ºæ¡† */
        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
        }
        .alert-info {
            background: #e6f7ff;
            color: #1890ff;
            border: 1px solid #91d5ff;
        }
        .alert-success {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }
        .alert-error {
            background: #fff1f0;
            color: #ff4d4f;
            border: 1px solid #ffccc7;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        .stat-card {
            background: #fff;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e8e8e8;
        }
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        .stat-total .stat-number { color: #1890ff; }
        .stat-success .stat-number { color: #52c41a; }
        .stat-failed .stat-number { color: #ff4d4f; }
        
        /* é”™è¯¯åˆ—è¡¨ */
        .error-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }
        .error-item {
            padding: 8px 12px;
            background: #fff1f0;
            border-left: 3px solid #ff4d4f;
            margin-bottom: 8px;
            font-size: 13px;
            color: #333;
        }
        
        .footer {
            height: 50px;
            background: #fff;
            border-top: 1px solid #e8e8e8;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-header">å¿ƒæ‚¦ç®¡ç†åå°</div>
            <div class="sidebar-menu" id="sidebarMenu">
                <!-- ä¾§è¾¹æ èœå•ç”± admin-sidebar.js åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="header">
                <div class="header-title">æ‰¹é‡å¯¼å…¥èµ„æº</div>
                <div class="header-right">
                    <a href="/" class="btn btn-default" target="_blank">æŸ¥çœ‹ç½‘ç«™</a>
                    <div class="user-info" onclick="logout()">
                        <div class="avatar">A</div>
                        <span>ç®¡ç†å‘˜</span>
                    </div>
                </div>
            </div>
            
            <div class="content">
                <div id="alertBox"></div>
                
                <!-- ä½¿ç”¨è¯´æ˜ -->
                <div class="card">
                    <div class="card-title">ğŸ“ å¯¼å…¥è¯´æ˜</div>
                    <div class="alert alert-info">
                        <strong>æ”¯æŒæ ¼å¼:</strong><br>
                        1. çº¯é“¾æ¥: https://pan.quark.cn/s/abc123<br>
                        2. æ ‡é¢˜|é“¾æ¥: é€Ÿåº¦ä¸æ¿€æƒ…|https://pan.quark.cn/s/abc123<br>
                        3. é“¾æ¥|æ ‡é¢˜: https://pan.quark.cn/s/abc123|é€Ÿåº¦ä¸æ¿€æƒ…<br><br>
                        <strong>æ³¨æ„äº‹é¡¹:</strong><br>
                        â€¢ ç©ºè¡Œå’Œä»¥ # å¼€å¤´çš„è¡Œä¼šè¢«å¿½ç•¥<br>
                        â€¢ é‡å¤çš„é“¾æ¥ä¼šè¢«è·³è¿‡<br>
                        â€¢ å»ºè®®æ¯æ¬¡å¯¼å…¥ä¸è¶…è¿‡1000æ¡
                    </div>
                </div>
                
                <!-- å¯¼å…¥è®¾ç½® -->
                <div class="card">
                    <div class="card-title">âš™ï¸ å¯¼å…¥è®¾ç½®</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        <div class="form-group">
                            <label class="form-label">ç½‘ç›˜ç±»å‹</label>
                            <select class="form-select" id="panType">
                                <option value="0">å¤¸å…‹ç½‘ç›˜</option>
                                <option value="2">ç™¾åº¦ç½‘ç›˜</option>
                                <option value="3">é˜¿é‡Œäº‘ç›˜</option>
                                <option value="4">UCç½‘ç›˜</option>
                                <option value="5">è¿…é›·ç½‘ç›˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ˜¯å¦ä¸´æ—¶èµ„æº</label>
                            <select class="form-select" id="isTime">
                                <option value="0">æ°¸ä¹…</option>
                                <option value="1">ä¸´æ—¶</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">èµ„æºçŠ¶æ€</label>
                            <select class="form-select" id="status">
                                <option value="1">å¯ç”¨</option>
                                <option value="0">ç¦ç”¨</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- å¯¼å…¥å†…å®¹ -->
                <div class="card">
                    <div class="card-title">ğŸ“‹ å¯¼å…¥å†…å®¹</div>
                    <div class="form-group">
                        <textarea class="form-textarea" id="importContent" placeholder="è¯·åœ¨æ­¤ç²˜è´´è¦å¯¼å…¥çš„èµ„æºé“¾æ¥..."></textarea>
                        <div class="form-help">
                            è¡Œæ•°: <span id="lineCount">0</span> | å­—ç¬¦æ•°: <span id="charCount">0</span>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="startImport()">ğŸš€ å¼€å§‹å¯¼å…¥</button>
                        <button class="btn btn-default" onclick="clearContent()">ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹</button>
                    </div>
                </div>
                
                <!-- å¯¼å…¥ç»“æœ -->
                <div id="resultSection" class="card" style="display: none;">
                    <div class="card-title">ğŸ“Š å¯¼å…¥ç»“æœ</div>
                    <div class="stats-row">
                        <div class="stat-card stat-total">
                            <div class="stat-number" id="totalCount">0</div>
                            <div class="stat-label">æ€»æ•°</div>
                        </div>
                        <div class="stat-card stat-success">
                            <div class="stat-number" id="successCount">0</div>
                            <div class="stat-label">æˆåŠŸ</div>
                        </div>
                        <div class="stat-card stat-failed">
                            <div class="stat-number" id="failedCount">0</div>
                            <div class="stat-label">å¤±è´¥</div>
                        </div>
                    </div>
                    
                    <div id="errorContainer" style="display: none;">
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e8e8e8;">
                            <strong style="color: #ff4d4f;">âŒ å¤±è´¥è¯¦æƒ…:</strong>
                            <div class="error-list" id="errorList"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer">Copyright Â© 2025 å¿ƒæ‚¦ç½‘ç›˜æœç´¢ç³»ç»Ÿ. Powered by Go</div>
        </div>
    </div>
    
    <script>
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('admin_token');
                window.location.href = '/admin/login';
            }
        }
        
        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.innerHTML = '<div class="alert alert-' + type + '">' + message + '</div>';
            setTimeout(function() {
                alertBox.innerHTML = '';
            }, 3000);
        }
        
        function updateStats() {
            const textarea = document.getElementById('importContent');
            const content = textarea.value;
            const lines = content.split('\n').filter(function(line) {
                const trimmed = line.trim();
                return trimmed !== '' && !trimmed.startsWith('#');
            });
            
            document.getElementById('lineCount').textContent = lines.length;
            document.getElementById('charCount').textContent = content.length;
        }
        
        document.getElementById('importContent').addEventListener('input', updateStats);
        
        function clearContent() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
                document.getElementById('importContent').value = '';
                updateStats();
            }
        }
        
        async function startImport() {
            const content = document.getElementById('importContent').value.trim();
            if (!content) {
                showAlert('è¯·è¾“å…¥è¦å¯¼å…¥çš„å†…å®¹', 'error');
                return;
            }
            
            const lines = content.split('\n').filter(function(line) {
                const trimmed = line.trim();
                return trimmed !== '' && !trimmed.startsWith('#');
            });
            
            if (lines.length === 0) {
                showAlert('æ²¡æœ‰æœ‰æ•ˆçš„å¯¼å…¥å†…å®¹', 'error');
                return;
            }
            
            if (lines.length > 1000) {
                if (!confirm('å°†å¯¼å…¥ ' + lines.length + ' æ¡è®°å½•ï¼Œå»ºè®®åˆ†æ‰¹å¯¼å…¥ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ')) {
                    return;
                }
            }
            
            try {
                showAlert('æ­£åœ¨å¯¼å…¥ä¸­ï¼Œè¯·ç¨å€™...', 'info');
                
                const token = localStorage.getItem('admin_token');
                const response = await fetch('/api/admin/batch-import', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        content: content,
                        pan_type: parseInt(document.getElementById('panType').value),
                        is_time: parseInt(document.getElementById('isTime').value),
                        status: parseInt(document.getElementById('status').value)
                    })
                });
                
                const result = await response.json();
                
                if (result.code === 200) {
                    const data = result.data;
                    document.getElementById('totalCount').textContent = data.total;
                    document.getElementById('successCount').textContent = data.success;
                    document.getElementById('failedCount').textContent = data.failed;
                    document.getElementById('resultSection').style.display = 'block';
                    
                    
if (data.errors && data.errors.length > 0) {
                        const errorList = document.getElementById('errorList');
                        errorList.innerHTML = data.errors.map(function(error) {
                            return '<div class="error-item">' + error + '</div>';
                        }).join('');
                        document.getElementById('errorContainer').style.display = 'block';
                    } else {
                        document.getElementById('errorContainer').style.display = 'none';
                    }
                    
                    if (data.failed === 0) {
                        showAlert('å¯¼å…¥æˆåŠŸï¼å…±å¯¼å…¥ ' + data.success + ' æ¡è®°å½•', 'success');
                    } else {
                        showAlert('å¯¼å…¥å®Œæˆï¼æˆåŠŸ ' + data.success + ' æ¡ï¼Œå¤±è´¥ ' + data.failed + ' æ¡', 'info');
                    }
                } else {
                    showAlert('å¯¼å…¥å¤±è´¥: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('å¯¼å…¥å¤±è´¥:', error);
                showAlert('å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        updateStats();
    </script>
    
    <!-- å¼•å…¥ä¾§è¾¹æ JS -->
    <script src="/static/admin-sidebar.js"></script>
</body>
</html>
{{end}}